#!/usr/bin/env node

/**
 * Module dependencies.
 */
var program = require('commander');
var fs = require('fs');
var file = process.argv[2];
var newFile = process.argv[3];
var options = { encoding: 'utf8' };
var path = require('path');
var lib = require('./index');


program
  .version('0.0.1')
  .option('-d, --deletegen', 'Deletes files in generated')
  // .option('-ab, --template-source', 'Generates template file with source')
  .option('-g, --gen', 'Makes the file with template and source')
  .parse(process.argv);

var generator = function () {
	lib.fileShreader(function() {
		var mP = __dirname;
		var tempPath = path.join(mP, 'test/fixtures/source/layouts/default.html');
		var pagePath = path.join(mP, 'test/fixtures/source/pages');
		lib.sourceTemplate(tempPath, function(temp) {
			lib.sourcePage(pagePath, function(pages) {
				pages.forEach(function(eachPage) {
					lib.fileReader(path.join(pagePath, eachPage), function(err, contents) {
						if (err) throw err;
						var resultArray = temp[0].concat(contents, temp[1]);
						console.log(resultArray);
						var writePath = path.join(mP, 'test/fixtures/generated', eachPage);
						lib.fileWriter(writePath, resultArray, function(){});
					});
				});

			});
		});
	}); 
};

if (program.gen) generator();

if (program.deletegen) {
	lib.fileShreader(function(){}); 
	console.log('You have deleted files!');
} 


